var crypto = require('crypto');
var rand = require('csprng');
var mongoose = require('mongoose');
var user = require('config/models');
var Regex = require("regex");
 

exports.signup = function(email,password,name,callback) {

	var x = email;
	user.find({email:email},function(err,users){
			var len = users.length;
			console.log(len);
			if(len == 0){
			if (x.indexOf("@iitk.ac.in")!= -1) {
			var temp =rand(160, 36);
			var newpass = temp + password;
			var emailnew = email;
			var token = crypto.createHash('sha512').update(email +rand).digest("hex");
			var hashed_password = crypto.createHash('sha512').update(newpass).digest("hex");
			 console.log(email);
			var newuser = new user({
			    token: token,
			    email: emailnew,
			    name: name,
			    hashed_password: hashed_password,
			    salt :temp });
			 	if(password.length > 4){

				console.log(newuser);
			    newuser.save(function (err) {
			 
			    callback({'res':true,'response':"Sucessfully Registered",'token':token});
			 
			});
			}

		else{
		 
		    callback({'res':false,'response':"Weak Password"});
		 
		}
			
		}else{
			 
			    callback({'res':false,'response':"Enter a valid IITK Email"});
			 
			}
		}else{
			 
			    callback({'res':false,'response':"Email already Registered"});
			 
			}
	});
		
}		