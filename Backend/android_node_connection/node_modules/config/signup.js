var crypto = require('crypto');
var rand = require('csprng');
var mongoose = require('mongoose');
var user = require('config/models');
 var Regex = require("regex");
 
 
exports.signup = function(email,password,callback) {
 	console.log('has entered the emai if + '+email);
//save the email and checks weather it is a valid email or not.
	var x = email;
	console.log('has entered the emai if + '+x);
	if(!(x.indexOf("@")===x.length)){
						console.log('has entered the emai if + '+x);
//if you have a valid password or not (it should be more than 4 charecter)
		if (password.length > 4) {
		 				console.log('has entered the password if');
//create a token for authentication 
			var temp =rand(160, 36);
			var newpass = temp + password;
			var token = crypto.createHash('sha512').update(email +rand).digest("hex");
			var hashed_password = crypto.createHash('sha512').update(newpass).digest("hex");
			 
			var newuser = new user({
			    token: token,
			    email: email,
			    hashed_password: hashed_password,
			    salt :temp });
			 
			user.find({email: email},function(err,users){
			 
			var len = users.length;
			 
			if(len == 0){
				console.log('has entered the Sucessfully if');
			    newuser.save(function (err) {
			 
			    callback({'response':"Sucessfully Registered"});
			 
			});
			}
			else{
			 
			    callback({'response':"Email already Registered"});
			 
			}});
		}
		else{
		 
		    callback({'response':"Password Weak"});
		 
		}
	}
		else{
	 
	   	callback({'response':"Email Not Valid"});
	 
		}
}		